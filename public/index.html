<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>청소년자유공간 콤마 [방명록 등록]</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 2rem auto; padding: 1rem; }
        form { display: flex; flex-direction: column; gap: 0.8rem; }
        input, select, button { padding: 0.8rem; font-size: 1rem; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; }
        #result { margin-top: 1rem; padding: 1rem; background-color: #f0f0f0; }
    </style>
</head>
<body>
    <h1>콤마 입장 등록</h1>
    <form id="registerForm">
        <input type="text" id="name" placeholder="이름" required>
        
        <input type="tel" id="number" placeholder="010-****-****" maxlength="13" required>

        <select id="gender" required>
            <option value="">성별 선택</option>
            <option value="남성">남성</option>
            <option value="여성">여성</option>
        </select>
        <input type="number" id="age" placeholder="나이를 숫자로 입력하세요" required>
        <input type="text" id="region" placeholder="거주 지역 (예: 마포구)" required>
        <button type="submit">등록하기</button>
    </form>
    <a href="/admin.html" style="text-align: right; display: block; margin-top: 1rem;">관리자 페이지로 이동 &rarr;</a>
    <div id="result"></div>

    <script>
        const form = document.getElementById('registerForm');
        const resultDiv = document.getElementById('result');
        const numberInput = document.getElementById('number'); // 연락처 input 가져오기

        const API_URL = 'https://festival-backend-zika.onrender.com';

        // 2. 연락처 자동 하이픈 추가를 위한 스크립트
        numberInput.addEventListener('input', (event) => {
            const value = numberInput.value.replace(/\D/g, ''); // 숫자 이외의 문자 제거
            const length = value.length;
            
            let formattedNumber = '';
            if (length < 4) {
                formattedNumber = value;
            } else if (length < 8) {
                formattedNumber = `${value.substring(0, 3)}-${value.substring(3)}`;
            } else {
                formattedNumber = `${value.substring(0, 3)}-${value.substring(3, 7)}-${value.substring(7, 11)}`;
            }
            numberInput.value = formattedNumber;
        });

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); 
            // ... (이하 기존 form 제출 스크립트는 동일)
            const visitorData = {
                name: document.getElementById('name').value,
                number: numberInput.value,
                gender: document.getElementById('gender').value,
                age = document.getElementById('age').value;
                region: document.getElementById('region').value
            };

            resultDiv.textContent = '등록 중...';

            try {
                const response = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(visitorData)
                });
                
                if (!response.ok) throw new Error('서버 응답에 문제가 발생했습니다.');

                const registeredVisitor = await response.json();
                resultDiv.textContent = `✅ 등록 완료! [${registeredVisitor.id}] ${registeredVisitor.name}님 환영합니다.`;
                form.reset();
            } catch (error) {
                resultDiv.textContent = `❌ 등록 실패: ${error.message}`;
            }
        });
    </script>
</body>
</html>