<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025년 서북권 청소년 축제 [방명록 등록]</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 2rem auto; padding: 1rem; }
        form { display: flex; flex-direction: column; gap: 0.8rem; }
        input, select, button { padding: 0.8rem; font-size: 1rem; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; }
        #result { margin-top: 1rem; padding: 1rem; background-color: #f0f0f0; }
    </style>
</head>
<body>
    <h1> 2025년 서북권 청소년 축제 입장 등록</h1>
    <form id="registerForm">
        <input type="text" id="name" placeholder="이름" required>
        <input type="text" id="number" placeholder="연락처" required>        
        <select id="gender" required>
            <option value="">성별 선택</option>
            <option value="남성">남성</option>
            <option value="여성">여성</option>
        </select>
        <select id="age_group" required>
            <option value="">연령대 선택</option>
            <option value="유아">7세이하</option>            
            <option value="초등">8~13(초등)</option>
            <option value="중등">14~16(중등)</option>    
            <option value="고등">17~19(고등))</option>
            <option value="대학">20~24(대학))</option>
            <option value="성인">25세 이상</option>
        </select>
        <input type="text" id="region" placeholder="거주 지역 (예: 마포구)" required>
        <button type="submit">등록하기</button>
    </form>
    <div id="result"></div>

    <script>
const form = document.getElementById('registerForm');
const resultDiv = document.getElementById('result');

// 🚨 본인의 Render 서버 주소로 반드시 변경해주세요!
const API_URL = 'https://festival-backend-zika.onrender.com';

form.addEventListener('submit', async (event) => {
    // 1. 폼의 기본 동작(페이지 새로고침)을 막습니다.
    event.preventDefault(); 

    // 2. 폼에 입력된 값들을 가져옵니다.
    const visitorData = {
        name: document.getElementById('name').value,
        number: document.getElementById('number').value, // 연락처 추가
        gender: document.getElementById('gender').value,
        age_group: document.getElementById('age_group').value,
        region: document.getElementById('region').value
    };

    resultDiv.textContent = '등록 중...';

    try {
        // 3. fetch API를 사용해 서버에 POST 요청을 보냅니다.
        const response = await fetch(`${API_URL}/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(visitorData)
        });

        // 서버에서 에러 응답이 온 경우
        if (!response.ok) {
            throw new Error('서버 응답에 문제가 발생했습니다.');
        }

        // 4. 서버로부터 성공 응답을 받습니다.
        const registeredVisitor = await response.json();

        // 5. 결과 메시지를 화면에 보여줍니다.
        resultDiv.textContent = `✅ 등록 완료! [${registeredVisitor.id}] ${registeredVisitor.name}님 환영합니다.`;
        
        form.reset(); // 입력 폼을 깨끗하게 비웁니다.

    } catch (error) {
        // 6. 요청 중 에러가 발생한 경우 에러 메시지를 보여줍니다.
        resultDiv.textContent = `❌ 등록 실패: ${error.message}`;
    }
});
    </script>
</body>
</html>